import{jsxs as x,jsx as p}from"@dropins/tools/preact-jsx-runtime.js";import{useState as m,useEffect as f,useMemo as B}from"@dropins/tools/preact-compat.js";import{c as I,j as O,d as T,e as $}from"../chunks/getConfiguration.js";import{useState as _,useEffect as k}from"@dropins/tools/preact-hooks.js";import{u as z}from"../chunks/Provider.js";import{withText as D}from"@dropins/tools/i18n.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/lib.js";import"@dropins/tools/fetch-graphql.js";import"@dropins/tools/preact.js";import"@dropins/tools/components.js";var A=(r=>(r.idle="idle",r.loading="loading",r.ready="ready",r.error="error",r))(A||{});const U=r=>{const{href:n,rel:d,integrity:s,crossorigin:y}=r,[c,t]=_(n?"loading":"idle");return k(()=>{if(!n){t("idle");return}let e=document.querySelector(`link[href="${n}"]`);if(e)t(e.getAttribute("data-status"));else{e=document.createElement("link"),e.href=n,e.rel=d||"stylesheet",s&&(e.integrity=s),y&&(e.crossOrigin=y),e.setAttribute("data-status","loading"),document.head.appendChild(e);const i=g=>{e&&e.setAttribute("data-status",g.type==="load"?"ready":"error")};e.addEventListener("load",i),e.addEventListener("error",i)}const a=i=>{t(i.type==="load"?"ready":"error")};return e.addEventListener("load",a),e.addEventListener("error",a),()=>{e&&e.removeEventListener("load",a),e&&e.removeEventListener("error",a)}},[n,d,s,y]),c};var N=(r=>(r.idle="idle",r.loading="loading",r.ready="ready",r.error="error",r))(N||{});const V=r=>{const{src:n,crossorigin:d,integrity:s}=r,[y,c]=_(n?"loading":"idle");return k(()=>{if(!n){c("idle");return}let t=document.querySelector(`script[src="${n}"]`);if(t)c(t.getAttribute("data-status"));else{t=document.createElement("script"),t.src=n,t.async=!0,d&&(t.crossOrigin=d),s&&(t.integrity=s),t.setAttribute("data-status","loading"),document.body.appendChild(t);const a=i=>{t&&t.setAttribute("data-status",i.type==="load"?"ready":"error")};t.addEventListener("load",a),t.addEventListener("error",a)}const e=a=>{c(a.type==="load"?"ready":"error")};return t.addEventListener("load",e),t.addEventListener("error",e),()=>{t&&t.removeEventListener("load",e),t&&t.removeEventListener("error",e)}},[n,d,s]),y},W=D({LoadingString:"adyen.status.loading",NoClientKeyString:"adyen.error.noClientKey",NoPaymenthMethodsResponseString:"adyen.error.noPaymentMethodsResponse",NoCartIdString:"adyen.error.noCartId",ProcessingErrorString:"adyen.error.processingError"}),oe=W(r=>{const{cartId:n="",onPlaceOrder:d,handleServerError:s,LoadingString:y,NoClientKeyString:c,NoPaymenthMethodsResponseString:t,NoCartIdString:e}=r,a=I.getConfig(),{environment:i}=a,g=z(),[h,q]=m(!1),[C,w]=m(),[v,R]=m(!0),[u,j]=m(),[L,E]=m(),M=V({src:"https://checkoutshopper-live.adyen.com/checkoutshopper/sdk/5.49.0/adyen.js",integrity:"sha384-j985BuUlWlw+qDuxum1jpGVb4PVCKUdYIsqncdJn9/BbL9947Foo3/A3fXzKtXKd",crossorigin:"anonymous"}),P=U({rel:"stylesheet",href:"https://checkoutshopper-live.adyen.com/checkoutshopper/sdk/5.49.0/adyen.css",integrity:"sha384-qnBE7PYKjoczkCnsKztuq5/oFKUqP98X25aVmTb5YpMCci4yqktWu7PTu0pdcW2G",crossorigin:"anonymous"});f(()=>{h||O(i).then(o=>{const{clientKey:l}=o;l?(w(l),q(!0)):E(c)})},[c,i,h]),f(()=>{n?T(n).then(o=>{var l;(l=o.data)!=null&&l.adyenPaymentMethods.paymentMethodsResponse?j(o.data.adyenPaymentMethods.paymentMethodsResponse):E(t)}):E(e)},[t,e,n]);const b=B(()=>({paymentMethodsResponse:u,clientKey:C,locale:g,environment:i,paymentMethodsConfiguration:{card:{hasHolderName:!0,holderNameRequired:!0}},onSubmit:async(o,l)=>{const S={stateData:JSON.stringify(o.data)},K=o.data.paymentMethod.type;try{await $(n,K,S)}catch(F){s&&s(F),l.setStatus("ready")}}}),[s,C,i,g,u,n]);return f(()=>{M===N.ready&&P===A.ready&&h&&u!=null&&R(!1)},[M,u,P,h]),f(()=>{let o;return v||(async()=>await window.AdyenCheckout(b).then(S=>{o=S.create("dropin",{showPayButton:!1}),d&&d(()=>{o.submit()}),document.getElementsByClassName("adyen-container__content").length!==0&&o.mount(".adyen-container__content")}))(),()=>{o&&o.unmount()}},[u,b,v,d]),x("div",{id:"adyen-container",children:[v&&p("div",{class:"adyen-container__loading",children:y}),L&&p("div",{class:"adyen-container__errors",children:p("div",{class:"adyen-container__error",children:L})}),p("div",{class:"adyen-container__content"})]})});export{oe as AdyenPaymentMethod,oe as default};
