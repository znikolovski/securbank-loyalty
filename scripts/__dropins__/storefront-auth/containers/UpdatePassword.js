import{classes as S}from"@dropins/tools/lib.js";import{v as z,u as H,a as J,P as K}from"../chunks/usePasswordValidationMessage.js";import"@dropins/tools/event-bus.js";import{a as Q}from"../chunks/getStoreConfig.js";import{r as X}from"../chunks/resetPassword.js";import{c as q,g as Y,u as Z,T as $,F as E,B as W}from"../chunks/useInLineAlert.js";import{useState as w,useEffect as O,useCallback as k}from"@dropins/tools/preact-hooks.js";import{useText as D}from"@dropins/tools/i18n.js";import{InLineAlert as C}from"@dropins/tools/components.js";import{jsxs as j,jsx as l}from"@dropins/tools/preact-jsx-runtime.js";import{P as R}from"../chunks/PasswordField.js";import"@dropins/tools/preact-compat.js";import"../chunks/network-error.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/initialize.js";const B=(r,m)=>r.split("&").filter(a=>a.includes(m)).map(a=>a.split("=")[1])[0],tt=({isEmailConfirmationRequired:r,signInOnSuccess:m,passwordConfigs:s,routeRedirectOnSignIn:a,routeWrongUrlRedirect:d,onErrorCallback:o,onSuccessCallback:n,handleSetInLineAlertProps:i,routeRedirectOnPasswordUpdate:f})=>{const t=D({errorNotification:"Auth.Notification.errorNotification",updatePasswordMessage:"Auth.Notification.updatePasswordMessage",customerTokenErrorMessage:"Auth.Api.customerTokenErrorMessage"}),[v,h]=w({userName:"",status:!1}),[L,N]=w(""),[y,x]=w(!1),[p,b]=w(""),[F,U]=w(""),[P,_]=w(!1);O(()=>{const{search:c}=window.location;!c.includes("token=")&&!c.includes("email=")&&q(d)&&(window.location.href=d());const e=decodeURIComponent(c),T=B(e,"token"),V=B(e,"email");b(V),U(T)},[d]);const g=k(async c=>{c.preventDefault(),_(!0);const e=Y(c.target),T=(e==null?void 0:e.password)&&p&&F,V=(s==null?void 0:s.requiredCharacterClasses)||0,I=(s==null?void 0:s.minLength)||0;if(!z(e==null?void 0:e.password,V)||e.password.length<+I){x(!0),_(!1);return}if(!T){i({type:"error",text:t.errorNotification}),_(!1);return}const{message:A,success:M}=await X(p,F,e.password);if(M){if(r||!r&&!m){q(f)&&(window.location.href=f()),x(!0),_(!1),i({type:"success",text:t.updatePasswordMessage}),N("");return}const u=await Q({email:p,password:e.password,handleSetInLineAlertProps:i,onErrorCallback:o,translations:t});u!=null&&u.userName&&(q(a)?window.location.href=a():(h({userName:u==null?void 0:u.userName,status:!0}),n==null||n(u==null?void 0:u.userName)))}else i({type:"error",text:A}),o==null||o({message:A,success:M});_(!1)},[p,F,s,r,t,m,i,a,f,o,n]),G=k(c=>{N(c)},[]);return{isSuccessful:v,updatePasswordValue:L,isClickSubmit:y,isLoading:P,submitUpdatePassword:g,handleSetUpdatePasswordValue:G}},st=({signInOnSuccess:r=!0,formSize:m="default",routeRedirectOnSignIn:s,routeWrongUrlRedirect:a,successNotificationForm:d,onErrorCallback:o,onSuccessCallback:n,routeRedirectOnPasswordUpdate:i})=>{const f=D({title:"Auth.UpdatePasswordForm.title",buttonPrimary:"Auth.UpdatePasswordForm.buttonPrimary"}),{passwordConfigs:t,isEmailConfirmationRequired:v}=H(),{inLineAlertProps:h,handleSetInLineAlertProps:L}=Z(),{isSuccessful:N,updatePasswordValue:y,isClickSubmit:x,isLoading:p,submitUpdatePassword:b,handleSetUpdatePasswordValue:F}=tt({isEmailConfirmationRequired:v,signInOnSuccess:r,passwordConfigs:t,routeRedirectOnSignIn:s,routeWrongUrlRedirect:a,onErrorCallback:o,onSuccessCallback:n,handleSetInLineAlertProps:L,routeRedirectOnPasswordUpdate:i}),{isValidUniqueSymbols:U,defaultLengthMessage:P}=J({password:y,isClickSubmit:x,passwordConfigs:t});return d&&N.status?d(N.userName):j("div",{className:S(["auth-updatePasswordForm",m]),children:[l($,{text:f.title,bottomLine:!1,className:"auth-updatePasswordForm__title"}),h.text?l(C,{className:"auth-updatePasswordForm__notification",variant:"secondary",heading:h.text,icon:h.icon}):null,j(E,{name:"updatePassword_form",className:"auth-updatePasswordForm__form",submitCallback:b,isLoading:p,fieldsConfig:[],children:[l(R,{initialPassword:y,required:!0,className:"auth-updatePasswordForm__form__item",setPasswordValueCallback:F,isError:U==="error"||(P==null?void 0:P.status)==="error",children:l(K,{minLength:t==null?void 0:t.minLength,requiredCharacterClasses:t==null?void 0:t.requiredCharacterClasses,validateLengthConfig:P,isValidUniqueSymbols:U})}),l("div",{className:"auth-updatePasswordForm__button",children:l(W,{type:"submit",buttonText:f.buttonPrimary,variant:"primary",enableLoader:p})})]})]})},ht=({formSize:r,signInOnSuccess:m,routeRedirectOnPasswordUpdate:s,routeRedirectOnSignIn:a,routeWrongUrlRedirect:d,successNotificationForm:o,onErrorCallback:n,onSuccessCallback:i})=>l("div",{className:"auth-update-password",children:l(st,{formSize:r,signInOnSuccess:m,routeRedirectOnSignIn:a,routeWrongUrlRedirect:d,onErrorCallback:n,onSuccessCallback:i,successNotificationForm:o,routeRedirectOnPasswordUpdate:s})});export{ht as UpdatePassword,ht as default};
//# sourceMappingURL=UpdatePassword.js.map
