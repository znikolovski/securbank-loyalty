{"version":3,"file":"PlaceOrder.js","sources":["../../src/components/PlaceOrder/PlaceOrder.tsx","../../src/containers/PlaceOrder/PlaceOrder.tsx"],"sourcesContent":["import { FunctionComponent } from 'preact';\nimport { HTMLAttributes } from 'preact/compat';\nimport { classes } from '@adobe/elsie/lib';\nimport '@/checkout/components/PlaceOrder/PlaceOrder.css';\nimport { Button } from '@adobe/elsie/components';\nimport { Text } from '@adobe/elsie/i18n';\n\nexport interface PlaceOrderProps extends HTMLAttributes<HTMLButtonElement> {\n  onClick?: (e: any) => void;\n  isLoading?: boolean;\n}\n\nexport const PlaceOrder: FunctionComponent<PlaceOrderProps> = ({\n  className,\n  children,\n  ...props\n}) => {\n  const { onClick = () => {}, isLoading } = props;\n\n  return (\n    <div className={classes(['checkout-place-order', className])}>\n      <Button\n        className={classes(['checkout-place-order__button', className])}\n        size=\"medium\"\n        variant=\"primary\"\n        key=\"placeOrder\"\n        type=\"submit\"\n        onClick={onClick}\n        disabled={isLoading}\n      >\n        <Text id=\"Checkout.PlaceOrder.button\" />\n      </Button>\n    </div>\n  );\n};\n","import { HTMLAttributes } from 'preact/compat';\nimport { Container } from '@adobe/elsie/lib';\nimport { PlaceOrder as PlaceOrderComponent } from '@/checkout/components/PlaceOrder/PlaceOrder';\nimport {\n  BILLING_FORM_NAME,\n  LOGIN_FORM_NAME,\n  SHIPPING_FORM_NAME,\n} from '@/checkout/containers';\nimport { cartSignal } from '@/checkout/signals';\n\nexport interface PlaceOrderProps extends HTMLAttributes<HTMLDivElement> {\n  onClick: () => void;\n  handleServerError: (error: any) => void;\n}\n\nconst CHECKOUT_FORMS = [LOGIN_FORM_NAME, SHIPPING_FORM_NAME, BILLING_FORM_NAME];\n\nconst scrollToFirstInvalidField = (form: HTMLFormElement) => {\n  const firstInvalidField = form.querySelector(':invalid') as HTMLElement;\n\n  if (firstInvalidField) {\n    firstInvalidField.scrollIntoView({ behavior: 'smooth' });\n    firstInvalidField.focus();\n  }\n};\n\nconst canPlaceOrder = () => {\n  const formCollection = Array.from(document.forms) || [];\n\n  const invalidForms = formCollection\n    .filter((form) => {\n      return CHECKOUT_FORMS.includes(form.name);\n    })\n    .filter((form) => {\n      // ignore forms that are not visible\n      return form.offsetParent !== null;\n    })\n    .filter((form) => {\n      // this will trigger the validation on all the fields\n      return !form.checkValidity();\n    });\n\n  const canPlaceOrder = invalidForms.length === 0;\n\n  if (!canPlaceOrder) {\n    const firstInvalidForm = invalidForms[0];\n    scrollToFirstInvalidField(firstInvalidForm);\n  }\n\n  return canPlaceOrder;\n};\n\nexport const PlaceOrder: Container<PlaceOrderProps> = (props) => {\n  const { onClick, handleServerError } = props;\n\n  const handleOrderPlace = async () => {\n    if (!canPlaceOrder()) return;\n    try {\n      await onClick();\n    } catch (err) {\n      handleServerError(err);\n    }\n  };\n\n  return (\n    <PlaceOrderComponent\n      onClick={handleOrderPlace}\n      isLoading={cartSignal.value.pending}\n    />\n  );\n};\n"],"names":["PlaceOrder","className","children","props","onClick","isLoading","_jsx","classes","Button","size","variant","type","disabled","Text","id","CHECKOUT_FORMS","LOGIN_FORM_NAME","SHIPPING_FORM_NAME","BILLING_FORM_NAME","scrollToFirstInvalidField","form","firstInvalidField","querySelector","scrollIntoView","behavior","focus","canPlaceOrder","invalidForms","Array","from","document","forms","filter","includes","name","offsetParent","checkValidity","length","firstInvalidForm","handleServerError","PlaceOrderComponent","err","cartSignal","value","pending"],"mappings":"khBAYO,MAAMA,EAAiDA,CAAC,CAC7DC,UAAAA,EACAC,SAAAA,EACA,GAAGC,CACL,IAAM,CACE,KAAA,CAAEC,QAAAA,EAAUA,IAAM,CAAC,EAAGC,UAAAA,CAAcF,EAAAA,EAE1C,OACEG,EAAA,MAAA,CAAKL,UAAWM,EAAQ,CAAC,uBAAwBN,CAAS,CAAC,EAAEC,SAC3DI,EAACE,EAAM,CACLP,UAAWM,EAAQ,CAAC,+BAAgCN,CAAS,CAAC,EAC9DQ,KAAK,SACLC,QAAQ,UAERC,KAAK,SACLP,QAAAA,EACAQ,SAAUP,EAAUH,SAEpBI,EAACO,EAAI,CAACC,GAAG,4BAAA,CAA8B,GALnC,YAME,CAAA,CACL,CAET,ECnBMC,EAAiB,CAACC,EAAiBC,EAAoBC,CAAiB,EAExEC,EAA6BC,GAA0B,CACrDC,MAAAA,EAAoBD,EAAKE,cAAc,UAAU,EAEnDD,IACFA,EAAkBE,eAAe,CAAEC,SAAU,QAAA,CAAU,EACvDH,EAAkBI,MAAM,EAE5B,EAEMC,EAAgBA,IAAM,CAGpBC,MAAAA,GAFiBC,MAAMC,KAAKC,SAASC,KAAK,GAAK,IAGlDC,OAAiBZ,GACTL,EAAekB,SAASb,EAAKc,IAAI,CACzC,EACAF,OAAiBZ,GAETA,EAAKe,eAAiB,IAC9B,EACAH,OAAiBZ,GAET,CAACA,EAAKgB,eACd,EAEGV,EAAgBC,EAAaU,SAAW,EAE9C,GAAI,CAACX,EAAe,CACZY,MAAAA,EAAmBX,EAAa,CAAC,EACvCR,EAA0BmB,CAAgB,CAC5C,CAEOZ,OAAAA,CACT,EAEa1B,EAAoDG,GAAA,CACzD,KAAA,CAAEC,QAAAA,EAASmC,kBAAAA,CAAsBpC,EAAAA,EAWvC,OACEG,EAACkC,EAAmB,CAClBpC,QAXqB,SAAY,CACnC,GAAKsB,EAAc,EACf,GAAA,CACF,MAAMtB,EAAQ,QACPqC,EAAK,CACZF,EAAkBE,CAAG,CACvB,CAAA,EAMEpC,UAAWqC,EAAWC,MAAMC,OAAAA,CAC7B,CAEL"}