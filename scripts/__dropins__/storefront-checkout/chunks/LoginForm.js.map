{"version":3,"file":"LoginForm.js","sources":["../../src/components/LoginForm/Email.tsx","../../src/components/LoginForm/SignIn.tsx","../../src/components/LoginForm/LoginForm.tsx","../../src/components/LoginForm/SignOut.tsx","../../src/containers/LoginForm/LoginForm.tsx"],"sourcesContent":["import { Field, Input } from '@adobe/elsie/components';\nimport { useText } from '@adobe/elsie/i18n';\nimport { HTMLAttributes } from 'preact/compat';\nimport { FunctionComponent } from 'preact';\n\nexport interface LoginEmailProps extends HTMLAttributes<HTMLFormElement> {\n  value?: string;\n  error?: string;\n  hint?: string;\n  onChange: (e: any) => void;\n  onBlur: (e: any) => void;\n  onInvalid: (e: any) => void;\n}\n\nexport const Email: FunctionComponent<LoginEmailProps> = ({\n  value,\n  error,\n  hint,\n  onChange,\n  onBlur,\n  onInvalid,\n}) => {\n  const translations = useText({\n    LoginFormLabel: 'Checkout.LoginForm.ariaLabel',\n    LoginFormFloatingLabel: 'Checkout.LoginForm.floatingLabel',\n    LoginFormPlaceholder: 'Checkout.LoginForm.placeholder',\n  });\n\n  return (\n    <Field size=\"medium\" error={error} hint={hint}>\n      <Input\n        id=\"customer-email\"\n        name=\"customer-email\"\n        type=\"email\"\n        value={value}\n        autocomplete=\"email\"\n        placeholder={translations.LoginFormPlaceholder}\n        floatingLabel={translations.LoginFormFloatingLabel}\n        onChange={onChange}\n        onBlur={onBlur}\n        onInvalid={onInvalid}\n        required={true}\n        aria-label={translations.LoginFormLabel}\n        aria-required={true}\n      />\n    </Field>\n  );\n};\n","import { FunctionComponent } from 'preact';\nimport { Text } from '@adobe/elsie/i18n';\n\ntype SignInProps = {\n  onSignInClick?: (email: string | null) => void;\n  email: string | null;\n};\n\nexport const SignIn: FunctionComponent<SignInProps> = ({\n  onSignInClick,\n  email,\n}) => {\n  return (\n    <div className=\"checkout-login-form__sign-in\">\n      <Text id=\"Checkout.LoginForm.account\" />\n\n      <a\n        data-testid=\"sign-in-link\"\n        className=\"checkout-login-form__link\"\n        href=\"#\"\n        target=\"_blank\"\n        rel=\"noreferrer\"\n        onClick={(e) => {\n          e.preventDefault();\n          onSignInClick?.(email);\n        }}\n      >\n        <Text id=\"Checkout.LoginForm.signIn\" />\n      </a>\n    </div>\n  );\n};\n","import { Email, Heading } from '@/checkout/components';\nimport { SignOut, SignIn } from '@/checkout/components/LoginForm';\nimport '@/checkout/components/LoginForm/LoginForm.css';\nimport { Customer } from '@/checkout/data/models';\nimport { useText } from '@adobe/elsie/i18n';\nimport { classes } from '@adobe/elsie/lib';\nimport { FunctionComponent, HTMLAttributes } from 'preact/compat';\nimport { Divider } from '@adobe/elsie/components';\n\nexport interface LoginFormProps extends HTMLAttributes<HTMLDivElement> {\n  currentEmail: string | null;\n  hint?: string;\n  error?: string | null;\n  onEmailChange: (e: any) => void;\n  onEmailBlur: (e: any) => void;\n  onEmailInvalid: (e: any) => void;\n  onSignInClick?: (email: string | null) => void;\n  onSignOutClick?: () => void;\n  isAuthenticated: boolean;\n  customer?: Customer | null;\n}\n\nexport const LoginForm: FunctionComponent<LoginFormProps> = ({\n  name,\n  className,\n  currentEmail,\n  hint,\n  error = null,\n  onEmailChange,\n  onEmailBlur,\n  onEmailInvalid,\n  onSignInClick,\n  onSignOutClick,\n  isAuthenticated,\n  customer,\n  ...props\n}) => {\n  const translations = useText({\n    Title: 'Checkout.LoginForm.title',\n  });\n\n  return (\n    <div\n      {...props}\n      className={classes(['checkout-login-form', className])}\n      data-testid=\"checkout-login-form\"\n    >\n      <div className=\"checkout-login-form__heading\">\n        <Heading level={2} className=\"checkout-login-form__title\">\n          {translations.Title}\n        </Heading>\n        {isAuthenticated ? (\n          <SignOut onSignOutClick={onSignOutClick} />\n        ) : (\n          <SignIn onSignInClick={onSignInClick} email={currentEmail} />\n        )}\n      </div>\n      {customer ? (\n        <div className=\"checkout-login-form__customer-details\">\n          <div className=\"checkout-login-form__customer-name\">{`${customer?.firstName} ${customer?.lastName}`}</div>\n          <div className=\"checkout-login-form__customer-email\">\n            {customer?.email}\n          </div>\n        </div>\n      ) : (\n        <div className=\"checkout-login-form__content\">\n          <form\n            className={classes(['dropin-login-form__form', className])}\n            name={name}\n            noValidate\n          >\n            {/* Prevent 'Enter' key press from submitting this form. */}\n            <button\n              type=\"submit\"\n              disabled\n              style=\"display: none\"\n              aria-hidden=\"true\"\n            />\n            <Email\n              value={currentEmail || undefined}\n              error={error || ''}\n              hint={hint}\n              onChange={onEmailChange}\n              onBlur={onEmailBlur}\n              onInvalid={onEmailInvalid}\n            />\n          </form>\n        </div>\n      )}\n      <Divider variant=\"primary\" />\n    </div>\n  );\n};\n","import { FunctionComponent } from 'preact';\nimport { Text } from '@adobe/elsie/i18n';\n\ntype SignOutProps = {\n  onSignOutClick?: () => void;\n};\n\nexport const SignOut: FunctionComponent<SignOutProps> = ({\n  onSignOutClick,\n}) => {\n  return (\n    <p className=\"checkout-login-form__sign-out\">\n      <Text id=\"Checkout.LoginForm.switch\" />\n\n      <a\n        className=\"checkout-login-form__link\"\n        href=\"#\"\n        target=\"_blank\"\n        rel=\"noreferrer\"\n        onClick={(e) => {\n          e.preventDefault();\n          onSignOutClick?.();\n        }}\n      >\n        <Text id=\"Checkout.LoginForm.signOut\" />\n      </a>\n    </p>\n  );\n};\n","import { isEmailAvailable, setGuestEmailOnCart } from '@/checkout/api';\nimport { LoginForm as LoginFormComponent } from '@/checkout/components/LoginForm';\nimport { useText } from '@adobe/elsie/i18n';\nimport { HTMLAttributes } from 'preact/compat';\nimport { useEffect, useState } from 'preact/hooks';\nimport { LOGIN_FORM_NAME } from './constants';\nimport {\n  cartSignal,\n  customerSignal,\n  isAuthenticatedSignal,\n} from '@/checkout/signals';\nimport { FunctionComponent } from 'preact';\nimport { patterns } from '@/checkout/components';\n\nconst isValidEmail = (email: string) => patterns.email.test(email);\n\nexport interface LoginFormProps extends HTMLAttributes<HTMLDivElement> {\n  email?: string;\n  onSignInClick?: (email: string | null) => void;\n  onSignOutClick?: () => void;\n}\n\nconst DEBOUNCE_TIME = 1000;\n\nexport const LoginForm: FunctionComponent<LoginFormProps> = ({\n  className,\n  email = null,\n  onSignInClick,\n  onSignOutClick,\n  ...props\n}) => {\n  const translations = useText({\n    LoginFormInvalidEmailError: 'Checkout.LoginForm.invalidEmailError',\n    LoginFormMissingEmailError: 'Checkout.LoginForm.missingEmailError',\n    LoginFormEmailExistsAlreadyHaveAccount:\n      'Checkout.LoginForm.emailExists.alreadyHaveAccount',\n    LoginFormEmailExistsSignInButton:\n      'Checkout.LoginForm.emailExists.signInButton',\n    LoginFormEmailExistsForFasterCheckout:\n      'Checkout.LoginForm.emailExists.forFasterCheckout',\n  });\n\n  const { data: cartData } = cartSignal.value;\n  const cartId = cartData?.id || '';\n  const hasCartData = !!cartData;\n\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [currentEmail, setCurrentEmail] = useState<string | null>(email);\n  const [error, setError] = useState<string | null>();\n  const [emailAvailability, setEmailAvailability] = useState<boolean>(true);\n\n  const errorMessage = (validity: ValidityState): string | null => {\n    if (validity.valid) return null;\n    if (validity.valueMissing) return translations.LoginFormMissingEmailError;\n    return translations.LoginFormInvalidEmailError;\n  };\n\n  const customer = customerSignal.value.data;\n\n  const onEmailChange = (e: any) => {\n    const { value } = e.target as HTMLInputElement;\n    setCurrentEmail(value);\n    setError(null);\n    setEmailAvailability(true);\n  };\n\n  const onEmailBlur = (e: any) => {\n    const { validity } = e.target as HTMLInputElement;\n    setError(errorMessage(validity));\n  };\n\n  const onEmailInvalid = (e: any) => {\n    const { validity } = e.target as HTMLInputElement;\n    setError(errorMessage(validity));\n  };\n\n  if (!isInitialized && hasCartData) {\n    setIsInitialized(true);\n    setCurrentEmail(cartData?.email || email);\n  }\n\n  useEffect(() => {\n    if (!currentEmail || error) return;\n\n    const timer = setTimeout(() => {\n      isEmailAvailable(currentEmail)\n        .then((result) => {\n          setEmailAvailability(result);\n\n          if (cartData?.email === currentEmail) return;\n\n          setGuestEmailOnCart({\n            cartId,\n            email: currentEmail,\n          }).catch((e: any) => {\n            console.log('set email failed', e);\n          });\n        })\n        .catch((e: any) => {\n          // TODO: handle error state\n          console.log(e);\n          setError(translations.LoginFormInvalidEmailError);\n          setEmailAvailability(true);\n        });\n    }, DEBOUNCE_TIME);\n\n    return () => {\n      timer && clearTimeout(timer);\n    };\n  }, [\n    currentEmail,\n    error,\n    translations.LoginFormInvalidEmailError,\n    cartData?.email,\n    cartId,\n  ]);\n\n  const hint = emailAvailability ? (\n    ''\n  ) : (\n    <>\n      {translations.LoginFormEmailExistsAlreadyHaveAccount}{' '}\n      <a\n        href=\"#\"\n        onClick={(e) => {\n          e.preventDefault();\n          onSignInClick?.(currentEmail);\n        }}\n      >\n        {translations.LoginFormEmailExistsSignInButton}\n      </a>{' '}\n      {translations.LoginFormEmailExistsForFasterCheckout}\n    </>\n  );\n\n  const onSignInClickHandler = (email: string | null) => {\n    const isCurrentEmailValid = currentEmail\n      ? isValidEmail(currentEmail)\n      : false;\n    onSignInClick?.(isCurrentEmailValid ? email : null);\n  };\n\n  return (\n    <LoginFormComponent\n      className={className}\n      currentEmail={currentEmail}\n      error={error}\n      hint={hint as any}\n      name={LOGIN_FORM_NAME}\n      onEmailBlur={onEmailBlur}\n      onEmailChange={onEmailChange}\n      onEmailInvalid={onEmailInvalid}\n      onSignInClick={onSignInClickHandler}\n      onSignOutClick={onSignOutClick}\n      isAuthenticated={Boolean(isAuthenticatedSignal.value)}\n      customer={customer}\n      {...props}\n    />\n  );\n};\n"],"names":["Email","value","error","hint","onChange","onBlur","onInvalid","translations","useText","LoginFormLabel","LoginFormFloatingLabel","LoginFormPlaceholder","_jsx","Field","size","children","Input","id","name","type","autocomplete","placeholder","floatingLabel","required","SignIn","onSignInClick","email","_jsxs","className","Text","href","target","rel","onClick","e","preventDefault","LoginForm","currentEmail","onEmailChange","onEmailBlur","onEmailInvalid","onSignOutClick","isAuthenticated","customer","props","Title","classes","Heading","level","SignOut","firstName","lastName","noValidate","disabled","style","undefined","Divider","variant","isValidEmail","patterns","test","DEBOUNCE_TIME","LoginFormInvalidEmailError","LoginFormMissingEmailError","LoginFormEmailExistsAlreadyHaveAccount","LoginFormEmailExistsSignInButton","LoginFormEmailExistsForFasterCheckout","data","cartData","cartSignal","cartId","hasCartData","isInitialized","setIsInitialized","useState","setCurrentEmail","setError","emailAvailability","setEmailAvailability","errorMessage","validity","valid","valueMissing","customerSignal","useEffect","timer","setTimeout","then","result","setGuestEmailOnCart","catch","log","console","clearTimeout","_Fragment","LoginFormComponent","LOGIN_FORM_NAME","isCurrentEmailValid","Boolean","isAuthenticatedSignal"],"mappings":"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"}