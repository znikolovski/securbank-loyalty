{"version":3,"file":"render.js","sources":["../src/lib/localStorage.ts","../src/services/backup.ts","../node_modules/deepmerge/dist/cjs.js","../src/render/Provider.tsx","../src/render/render.tsx"],"sourcesContent":["import { Repository } from '@/checkout/services/backup';\n\nexport class LocalStorage implements Repository {\n  isAvailable(): boolean {\n    return !!window.localStorage;\n  }\n\n  getKeys(): string[] {\n    if (!this.isAvailable()) return [];\n    return Object.keys(window.localStorage);\n  }\n\n  setItem(key: string, value: string): void {\n    if (!this.isAvailable()) return;\n    window.localStorage.setItem(key, value);\n  }\n\n  getItem(key: string): string | null {\n    if (!this.isAvailable()) return null;\n    return window.localStorage.getItem(key);\n  }\n\n  removeItem(key: string): void {\n    if (!this.isAvailable()) return;\n    window.localStorage.removeItem(key);\n  }\n}\n","export interface Repository {\n  getKeys(): string[];\n  getItem(key: string): string | null;\n  setItem(key: string, value: string): void;\n  removeItem(key: string): void;\n}\n\nexport class BackupService {\n  private namespace: string;\n  private repository: Repository;\n\n  constructor(namespace: string, repository: Repository) {\n    this.namespace = namespace;\n    this.repository = repository;\n  }\n\n  private namespaced(key: string): string {\n    return `${this.namespace}:${key}`;\n  }\n\n  public backup<T>(key: string, value: T): void {\n    return this.repository.setItem(this.namespaced(key), JSON.stringify(value));\n  }\n\n  public restore<T>(key: string): T | null {\n    const value = this.repository.getItem(this.namespaced(key));\n    if (!value) return null;\n    return JSON.parse(value);\n  }\n\n  public remove(key: string): void {\n    return this.repository.removeItem(this.namespaced(key));\n  }\n\n  public clear(): void {\n    this.repository\n      .getKeys()\n      .filter((key) => key.startsWith(this.namespace))\n      .forEach((key) => {\n        this.repository.removeItem(key);\n      });\n  }\n}\n","'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn Object.propertyIsEnumerable.call(target, symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","import { config } from '@/checkout/api';\nimport {\n  AddressFormFieldsProvider,\n  CheckoutStateProvider,\n  CountriesProvider,\n  ServicesProvider,\n  StoreProvider,\n} from '@/checkout/context';\nimport { LocalStorage } from '@/checkout/lib';\nimport { BackupService } from '@/checkout/services';\nimport { UIProvider } from '@adobe/elsie/components';\nimport { Lang } from '@adobe/elsie/i18n';\nimport { deepmerge } from '@adobe/elsie/lib/deepmerge';\nimport { events } from '@adobe/event-bus';\nimport { FunctionComponent } from 'preact';\nimport { useEffect, useMemo, useState } from 'preact/hooks';\n\nimport en_US from '../i18n/en_US.json';\n\n// Langs\nconst langDefinitions = {\n  default: en_US,\n};\n\ninterface IntlProviderProps {\n  children?: any;\n}\n\nexport const IntlProvider: FunctionComponent<IntlProviderProps> = ({\n  children,\n}) => {\n  const [locale, setLang] = useState<Lang>();\n\n  const userLangDefinitions = config.getConfig()?.langDefinitions;\n\n  useEffect(() => {\n    const localeEvent = events.on(\n      'locale',\n      (payload) => {\n        if (payload !== locale) setLang(payload as Lang);\n      },\n      { eager: true }\n    );\n    return () => {\n      localeEvent?.off();\n    };\n  }, [locale]);\n\n  // Merge language definitions with user language definitions\n  const definitions = deepmerge(langDefinitions, userLangDefinitions ?? {});\n\n  return (\n    <UIProvider lang={locale} langDefinitions={definitions}>\n      {children}\n    </UIProvider>\n  );\n};\n\nexport const DataProvider: FunctionComponent<IntlProviderProps> = ({\n  children,\n}) => {\n  const backupService = useMemo(() => {\n    return new BackupService('DROPIN__CHECKOUT', new LocalStorage());\n  }, []);\n\n  return (\n    <ServicesProvider services={{ backupService }}>\n      <StoreProvider>\n        <AddressFormFieldsProvider>\n          <CountriesProvider>\n            <CheckoutStateProvider>{children}</CheckoutStateProvider>\n          </CountriesProvider>\n        </AddressFormFieldsProvider>\n      </StoreProvider>\n    </ServicesProvider>\n  );\n};\n\nexport const Provider: FunctionComponent<IntlProviderProps> = ({\n  children,\n}) => {\n  return (\n    <DataProvider>\n      <IntlProvider>{children}</IntlProvider>\n    </DataProvider>\n  );\n};\n","if (process.env.NODE_ENV === 'development') {\n  // Must use require here as import statements are only allowed to exist at top-level.\n  require('preact/debug');\n}\n\nimport { Render } from '@adobe/elsie/lib';\nimport { Provider } from './Provider';\nexport { Provider };\nexport const render = new Render(<Provider />);\n"],"names":["LocalStorage","isAvailable","window","localStorage","getKeys","Object","keys","setItem","key","value","getItem","removeItem","BackupService","constructor","namespace","repository","namespaced","backup","JSON","stringify","restore","parse","remove","clear","filter","startsWith","forEach","isMergeableObject","isNonNullObject","isSpecial","stringValue","isReactElement","canUseSymbol","REACT_ELEMENT_TYPE","emptyTarget","val","cloneUnlessOtherwiseSpecified","options","deepmerge","defaultArrayMerge","target","source","element","getMergeFunction","customMerge","getEnumerableOwnPropertySymbols","symbol","propertyIsOnObject","object","property","propertyIsUnsafe","mergeObject","destination","sourceIsArray","targetIsArray","sourceAndTargetTypesMatch","array","prev","next","deepmerge_1","cjs","langDefinitions","default","en_US","IntlProvider","children","locale","setLang","useState","userLangDefinitions","config","getConfig","useEffect","localeEvent","events","on","payload","eager","off","definitions","_jsx","UIProvider","lang","DataProvider","backupService","useMemo","ServicesProvider","services","StoreProvider","AddressFormFieldsProvider","CountriesProvider","CheckoutStateProvider","Provider","render","Render"],"mappings":"spBAEO,MAAMA,CAAmC,CAC9CC,aAAuB,CACd,MAAA,CAAC,CAACC,OAAOC,YAClB,CAEAC,SAAoB,CACd,OAAC,KAAKH,YAAY,EACfI,OAAOC,KAAKJ,OAAOC,YAAY,EADN,EAElC,CAEAI,QAAQC,EAAaC,EAAqB,CACnC,KAAKR,YAAY,GACfE,OAAAA,aAAaI,QAAQC,EAAKC,CAAK,CACxC,CAEAC,QAAQF,EAA4B,CAC9B,OAAC,KAAKP,YAAY,EACfC,OAAOC,aAAaO,QAAQF,CAAG,EADN,IAElC,CAEAG,WAAWH,EAAmB,CACvB,KAAKP,YAAY,GACfE,OAAAA,aAAaQ,WAAWH,CAAG,CACpC,CACF,CCnBO,MAAMI,CAAc,CAIzBC,YAAYC,EAAmBC,EAAwB,CAH/CD,EAAAA,kBACAC,EAAAA,mBAGN,KAAKD,UAAYA,EACjB,KAAKC,WAAaA,CACpB,CAEQC,WAAWR,EAAqB,CACtC,MAAO,GAAG,KAAKM,SAAS,IAAIN,CAAG,EACjC,CAEOS,OAAUT,EAAaC,EAAgB,CACrC,OAAA,KAAKM,WAAWR,QAAQ,KAAKS,WAAWR,CAAG,EAAGU,KAAKC,UAAUV,CAAK,CAAC,CAC5E,CAEOW,QAAWZ,EAAuB,CACvC,MAAMC,EAAQ,KAAKM,WAAWL,QAAQ,KAAKM,WAAWR,CAAG,CAAC,EAC1D,OAAKC,EACES,KAAKG,MAAMZ,CAAK,EADJ,IAErB,CAEOa,OAAOd,EAAmB,CAC/B,OAAO,KAAKO,WAAWJ,WAAW,KAAKK,WAAWR,CAAG,CAAC,CACxD,CAEOe,OAAc,CACnB,KAAKR,WACFX,QACAoB,EAAAA,OAAgBhB,GAAAA,EAAIiB,WAAW,KAAKX,SAAS,CAAC,EAC9CY,QAAiBlB,GAAA,CACXO,KAAAA,WAAWJ,WAAWH,CAAG,CAAA,CAC/B,CACL,CACF,qGCxCA,IAAImB,EAAoB,SAA2BlB,EAAO,CACzD,OAAOmB,EAAgBnB,CAAK,GACxB,CAACoB,EAAUpB,CAAK,CACrB,EAEA,SAASmB,EAAgBnB,EAAO,CAC/B,MAAO,CAAC,CAACA,GAAS,OAAOA,GAAU,QACpC,CAEA,SAASoB,EAAUpB,EAAO,CACzB,IAAIqB,EAAc,OAAO,UAAU,SAAS,KAAKrB,CAAK,EAEtD,OAAOqB,IAAgB,mBACnBA,IAAgB,iBAChBC,EAAetB,CAAK,CACzB,CAGA,IAAIuB,EAAe,OAAO,QAAW,YAAc,OAAO,IACtDC,EAAqBD,EAAe,OAAO,IAAI,eAAe,EAAI,MAEtE,SAASD,EAAetB,EAAO,CAC9B,OAAOA,EAAM,WAAawB,CAC3B,CAEA,SAASC,EAAYC,EAAK,CACzB,OAAO,MAAM,QAAQA,CAAG,EAAI,CAAE,EAAG,CAAE,CACpC,CAEA,SAASC,EAA8B3B,EAAO4B,EAAS,CACtD,OAAQA,EAAQ,QAAU,IAASA,EAAQ,kBAAkB5B,CAAK,EAC/D6B,EAAUJ,EAAYzB,CAAK,EAAGA,EAAO4B,CAAO,EAC5C5B,CACJ,CAEA,SAAS8B,EAAkBC,EAAQC,EAAQJ,EAAS,CACnD,OAAOG,EAAO,OAAOC,CAAM,EAAE,IAAI,SAASC,EAAS,CAClD,OAAON,EAA8BM,EAASL,CAAO,CACvD,CAAE,CACF,CAEA,SAASM,EAAiBnC,EAAK6B,EAAS,CACvC,GAAI,CAACA,EAAQ,YACZ,OAAOC,EAER,IAAIM,EAAcP,EAAQ,YAAY7B,CAAG,EACzC,OAAO,OAAOoC,GAAgB,WAAaA,EAAcN,CAC1D,CAEA,SAASO,EAAgCL,EAAQ,CAChD,OAAO,OAAO,sBACX,OAAO,sBAAsBA,CAAM,EAAE,OAAO,SAASM,EAAQ,CAC9D,OAAO,OAAO,qBAAqB,KAAKN,EAAQM,CAAM,CACzD,CAAG,EACC,CAAE,CACN,CAEA,SAAS1C,EAAQoC,EAAQ,CACxB,OAAO,OAAO,KAAKA,CAAM,EAAE,OAAOK,EAAgCL,CAAM,CAAC,CAC1E,CAEA,SAASO,EAAmBC,EAAQC,EAAU,CAC7C,GAAI,CACH,OAAOA,KAAYD,CACnB,MAAU,CACV,MAAO,EACP,CACF,CAGA,SAASE,EAAiBV,EAAQhC,EAAK,CACtC,OAAOuC,EAAmBP,EAAQhC,CAAG,GACjC,EAAE,OAAO,eAAe,KAAKgC,EAAQhC,CAAG,GACvC,OAAO,qBAAqB,KAAKgC,EAAQhC,CAAG,EAClD,CAEA,SAAS2C,EAAYX,EAAQC,EAAQJ,EAAS,CAC7C,IAAIe,EAAc,CAAA,EAClB,OAAIf,EAAQ,kBAAkBG,CAAM,GACnCpC,EAAQoC,CAAM,EAAE,QAAQ,SAAShC,EAAK,CACrC4C,EAAY5C,CAAG,EAAI4B,EAA8BI,EAAOhC,CAAG,EAAG6B,CAAO,CACxE,CAAG,EAEFjC,EAAQqC,CAAM,EAAE,QAAQ,SAASjC,EAAK,CACjC0C,EAAiBV,EAAQhC,CAAG,IAI5BuC,EAAmBP,EAAQhC,CAAG,GAAK6B,EAAQ,kBAAkBI,EAAOjC,CAAG,CAAC,EAC3E4C,EAAY5C,CAAG,EAAImC,EAAiBnC,EAAK6B,CAAO,EAAEG,EAAOhC,CAAG,EAAGiC,EAAOjC,CAAG,EAAG6B,CAAO,EAEnFe,EAAY5C,CAAG,EAAI4B,EAA8BK,EAAOjC,CAAG,EAAG6B,CAAO,EAExE,CAAE,EACMe,CACR,CAEA,SAASd,EAAUE,EAAQC,EAAQJ,EAAS,CAC3CA,EAAUA,GAAW,GACrBA,EAAQ,WAAaA,EAAQ,YAAcE,EAC3CF,EAAQ,kBAAoBA,EAAQ,mBAAqBV,EAGzDU,EAAQ,8BAAgCD,EAExC,IAAIiB,EAAgB,MAAM,QAAQZ,CAAM,EACpCa,EAAgB,MAAM,QAAQd,CAAM,EACpCe,EAA4BF,IAAkBC,EAElD,OAAKC,EAEMF,EACHhB,EAAQ,WAAWG,EAAQC,EAAQJ,CAAO,EAE1Cc,EAAYX,EAAQC,EAAQJ,CAAO,EAJnCD,EAA8BK,EAAQJ,CAAO,CAMtD,CAEAC,EAAU,IAAM,SAAsBkB,EAAOnB,EAAS,CACrD,GAAI,CAAC,MAAM,QAAQmB,CAAK,EACvB,MAAM,IAAI,MAAM,mCAAmC,EAGpD,OAAOA,EAAM,OAAO,SAASC,EAAMC,EAAM,CACxC,OAAOpB,EAAUmB,EAAMC,EAAMrB,CAAO,CACpC,EAAE,EAAE,CACN,EAEA,IAAIsB,EAAcrB,EAElBsB,EAAiBD,4wFChHXE,EAAkB,CACtBC,QAASC,CACX,EAMaC,EAAqDA,CAAC,CACjEC,SAAAA,CACF,IAAM,OACJ,KAAM,CAACC,EAAQC,CAAO,EAAIC,EAAe,EAEnCC,GAAsBC,EAAAA,EAAOC,UAAAA,IAAPD,YAAAA,EAAoBT,gBAEhDW,EAAU,IAAM,CACd,MAAMC,EAAcC,EAAOC,GACzB,SACaC,GAAA,CACPA,IAAYV,GAAQC,EAAQS,CAAgB,CAAA,EAElD,CAAEC,MAAO,EAAA,CACX,EACA,MAAO,IAAM,CACXJ,GAAAA,MAAAA,EAAaK,KAAI,CACnB,EACC,CAACZ,CAAM,CAAC,EAGX,MAAMa,EAAczC,EAAUuB,EAAiBQ,GAAuB,CAAE,CAAA,EAExE,OACEW,EAACC,EAAU,CAACC,KAAMhB,EAAQL,gBAAiBkB,EAAYd,SAAAA,CAAAA,CAE3C,CAEhB,EAEakB,EAAqDA,CAAC,CACjElB,SAAAA,CACF,IAAM,CACEmB,MAAAA,EAAgBC,EAAQ,IACrB,IAAIzE,EAAc,mBAAoB,IAAIZ,CAAc,EAC9D,CAAE,CAAA,EAEL,OACEgF,EAACM,EAAgB,CAACC,SAAU,CAAEH,cAAAA,CAAc,EAAEnB,SAC5Ce,EAACQ,EAAa,CAAAvB,SACZe,EAACS,EAAyB,CAAAxB,SACxBe,EAACU,EAAiB,CAAAzB,SAChBe,EAACW,EAAqB,CAAA1B,SAAAA,CAAAA,CAAkC,CAAA,CACvC,CAAA,CACM,CAAA,CACd,CAAA,CACC,CAEtB,EAEa2B,EAAiDA,CAAC,CAC7D3B,SAAAA,CACF,IAEIe,EAACG,EAAY,CAAAlB,SACXe,EAAChB,EAAY,CAAAC,SAAAA,CAAAA,CAAyB,CAAA,CAC1B,EC5EL4B,GAAS,IAAIC,EAAOd,EAACY,EAAU,CAAA,CAAA,CAAC","x_google_ignoreList":[2]}